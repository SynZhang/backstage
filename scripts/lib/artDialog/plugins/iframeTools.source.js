/*!
 * artDialog iframeTools
 * Date: 2011-11-25 13:54
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */

(function(e,t,n,r){var i,s,o,u="@ARTDIALOG.DATA",a="@ARTDIALOG.OPEN",f="@ARTDIALOG.OPENER",l=t.name=t.name||"@ARTDIALOG.WINNAME"+ +(new Date),c=t.VBArray&&!t.XMLHttpRequest;e(function(){!t.jQuery&&document.compatMode==="BackCompat"&&alert('artDialog Error: document.compatMode === "BackCompat"')});var h=n.top=function(){var e=t,n=function(e){try{var n=t[e].document;n.getElementsByTagName}catch(r){return!1}return t[e].artDialog&&n.getElementsByTagName("frameset").length===0};return n("top")?e=t.top:n("parent")&&(e=t.parent),e}();n.parent=h,i=h.artDialog,o=function(){return i.defaults.zIndex},n.data=function(e,t){var i=n.top,s=i[u]||{};return i[u]=s,t===r?s[e]:(s[e]=t,s)},n.removeData=function(e){var t=n.top[u];t&&t[e]&&delete t[e]},n.through=s=function(){var e=i.apply(this,arguments);return h!==t&&(n.list[e.config.id]=e),e},h!==t&&e(t).bind("unload",function(){var e=n.list,t;for(var r in e)e[r]&&(t=e[r].config,t&&(t.duration=0),e[r].close())}),n.open=function(i,u,l){u=u||{};var h,p,d,v,m,g,y,b,w,E=n.top,S="position:absolute;left:-9999em;top:-9999em;border:none 0;background:transparent",x="width:100%;height:100%;border:none 0";if(l===!1){var T=+(new Date),N=i.replace(/([?&])_=[^&]*/,"$1_="+T);i=N+(N===i?(/\?/.test(i)?"&":"?")+"_="+T:"")}var C=function(){var t,n,r=p.content.find(".aui_loading"),i=h.config;d.addClass("aui_state_full"),r&&r.hide();try{b=m.contentWindow,y=e(b.document),w=b.document.body}catch(s){m.style.cssText=x,i.follow?h.follow(i.follow):h.position(i.left,i.top),u.init&&u.init.call(h,b,E),u.init=null;return}t=i.width==="auto"?y.width()+(c?0:parseInt(e(w).css("marginLeft"))):i.width,n=i.height==="auto"?y.height():i.height,setTimeout(function(){m.style.cssText=x},0),h.size(t,n),i.follow?h.follow(i.follow):h.position(i.left,i.top),u.init&&u.init.call(h,b,E),u.init=null},k={zIndex:o(),init:function(){h=this,p=h.DOM,v=p.main,d=p.content,m=h.iframe=E.document.createElement("iframe"),m.src=i,m.name="Open"+h.config.id,m.style.cssText=S,m.setAttribute("frameborder",0,0),m.setAttribute("allowTransparency",!0),g=e(m),h.content().appendChild(m),b=m.contentWindow;try{b.name=m.name,n.data(m.name+a,h),n.data(m.name+f,t)}catch(r){}g.bind("load",C)},close:function(){g.css("display","none").unbind("load",C);if(u.close&&u.close.call(this,m.contentWindow,E)===!1)return!1;d.removeClass("aui_state_full"),g[0].src="about:blank",g.remove();try{n.removeData(m.name+a),n.removeData(m.name+f)}catch(e){}}};typeof u.ok=="function"&&(k.ok=function(){return u.ok.call(h,m.contentWindow,E)}),typeof u.cancel=="function"&&(k.cancel=function(){return u.cancel.call(h,m.contentWindow,E)}),delete u.content;for(var L in u)k[L]===r&&(k[L]=u[L]);return s(k)},n.open.api=n.data(l+a),n.opener=n.data(l+f)||t,n.open.origin=n.opener,n.close=function(){var e=n.data(l+a);return e&&e.close(),!1},h!=t&&e(document).bind("mousedown",function(){var e=n.open.api;e&&e.zIndex()}),n.load=function(t,n,i){i=i||!1;var u=n||{},a={zIndex:o(),init:function(n){var r=this,s=r.config;e.ajax({url:t,success:function(e){r.content(e),u.init&&u.init.call(r,n)},cache:i})}};delete n.content;for(var f in u)a[f]===r&&(a[f]=u[f]);return s(a)},n.alert=function(e,t){return s({id:"Alert",zIndex:o(),icon:"warning",fixed:!0,lock:!0,content:e,ok:!0,close:t})},n.confirm=function(e,t,n){return s({id:"Confirm",zIndex:o(),icon:"question",fixed:!0,lock:!0,opacity:.1,content:e,ok:function(e){return t.call(this,e)},cancel:function(e){return n&&n.call(this,e)}})},n.prompt=function(e,t,n){n=n||"";var r;return s({id:"Prompt",zIndex:o(),icon:"question",fixed:!0,lock:!0,opacity:.1,content:['<div style="margin-bottom:5px;font-size:12px">',e,"</div>","<div>",'<input value="',n,'" style="width:18em;padding:6px 4px" />',"</div>"].join(""),init:function(){r=this.DOM.content.find("input")[0],r.select(),r.focus()},ok:function(e){return t&&t.call(this,r.value,e)},cancel:!0})},n.tips=function(e,t){return s({id:"Tips",zIndex:o(),title:!1,cancel:!1,fixed:!0,lock:!1}).content('<div style="padding: 0 1em;">'+e+"</div>").time(t||1.5)},e(function(){var r=n.dragEvent;if(!r)return;var i=e(t),s=e(document),o=c?"absolute":"fixed",u=r.prototype,a=document.createElement("div"),f=a.style;f.cssText="display:none;position:"+o+";left:0;top:0;width:100%;height:100%;"+"cursor:move;filter:alpha(opacity=0);opacity:0;background:#FFF",document.body.appendChild(a),u._start=u.start,u._end=u.end,u.start=function(){var e=n.focus.DOM,t=e.main[0],r=e.content[0].getElementsByTagName("iframe")[0];u._start.apply(this,arguments),f.display="block",f.zIndex=n.defaults.zIndex+3,o==="absolute"&&(f.width=i.width()+"px",f.height=i.height()+"px",f.left=s.scrollLeft()+"px",f.top=s.scrollTop()+"px"),r&&t.offsetWidth*t.offsetHeight>307200&&(t.style.visibility="hidden")},u.end=function(){var e=n.focus;u._end.apply(this,arguments),f.display="none",e&&(e.DOM.main[0].style.visibility="visible")}})})(this.art||this.jQuery,this,this.artDialog);